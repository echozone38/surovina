
<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Surovina v porcích</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:#0b1020;color:#e5e7eb;margin:0;padding:2rem;}
    h1,h2,h3{color:#e5e7eb;margin:0 0 .75rem}
    .card{background:#111827;border:1px solid #1f2937;border-radius:.75rem;padding:1rem;margin-bottom:1rem}
    label{display:block;margin:.25rem 0 .25rem;color:#93c5fd}
    input[type="number"]{width:100%;padding:.5rem;border-radius:.5rem;border:1px solid #374151;background:#0f172a;color:#e5e7eb}
    table{width:100%;border-collapse:collapse;margin-top:.5rem}
    th,td{border:1px solid #1f2937;padding:.5rem;text-align:left}
    th{background:#0f172a;color:#93c5fd}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    .btns{display:flex;gap:.5rem;margin-top:.5rem}
    button{background:#0f766e;color:white;border:none;border-radius:.5rem;padding:.5rem .75rem;cursor:pointer}
    button.secondary{background:#374151}
  </style>
</head>
<body>
  <h1>Surovina v porcích (Kája, Máša, Fanda, Tóňa)</h1>

  <div class="card">
    <h2>Surovina</h2>
    <label for="F1">Celková hmotnost [g]</label>
    <input id="F1" type="number" min="0" step="0.1" placeholder="Zadejte hmotnost" />
    <label for="SUMA" style="margin-top:.75rem">Suma</label>
    <input id="SUMA" type="number" readonly />
    <div class="btns">
      <button id="resetBtn" class="secondary">Vymazat vše (reset)</button>
      <button id="csvBtn">Export výsledků do CSV</button>
    </div>
  </div>

  <div class="card">
    <h3>Porce a podíly</h3>
    <p>Porce: F3,G3,H3,I3 s referencí G5. Podíly: F5,G5,H5,I5.</p>
    <table>
      <thead>
        <tr>
          <th>Osoba</th>
          <th>Porce (F3,G3,H3,I3)</th>
          <th>Podíly (F5,G5,H5,I5) [%]</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Kája</td>
          <td><input id="F3" type="number" readonly /></td>
          <td><input id="F5" type="number" min="0" step="0.1" placeholder="%" /></td>
        </tr>
        <tr>
          <td>Máša</td>
          <td><input id="G3" type="number" readonly /></td>
          <td><input id="G5" type="number" min="0" step="0.1" placeholder="% (referenční)" /></td>
        </tr>
        <tr>
          <td>Fanda</td>
          <td><input id="H3" type="number" readonly /></td>
          <td><input id="H5" type="number" min="0" step="0.1" placeholder="%" /></td>
        </tr>
        <tr>
          <td>Tóňa</td>
          <td><input id="I3" type="number" readonly /></td>
          <td><input id="I5" type="number" min="0" step="0.1" placeholder="%" /></td>
        </tr>
      </tbody>
    </table>
  </div>

<script>
(function(){
  const ids = ['F1','F3','G3','H3','I3','F5','G5','H5','I5','SUMA'];
  const el = Object.fromEntries(ids.map(id=>[id, document.getElementById(id)]));

  function recalc(){
    const F1 = parseFloat(el.F1.value)||0;
    const F5 = parseFloat(el.F5.value)||0;
    const G5 = parseFloat(el.G5.value)||0;
    const H5 = parseFloat(el.H5.value)||0;
    const I5 = parseFloat(el.I5.value)||0;

    if(G5>0){
      el.F3.value = +(F1 * F5 / G5).toFixed(2);
      el.G3.value = +(F1 * G5 / G5).toFixed(2);
      el.H3.value = +(F1 * H5 / G5).toFixed(2);
      el.I3.value = +(F1 * I5 / G5).toFixed(2);
    }else{
      el.F3.value = el.G3.value = el.H3.value = el.I3.value = '';
    }
    const suma = ['F3','G3','H3','I3'].reduce((s,k)=>s+(parseFloat(el[k].value)||0),0);
    el.SUMA.value = G5>0 ? +suma.toFixed(2) : '';
    // persist
    localStorage.setItem('porce_state', JSON.stringify({F1,F5,G5,H5,I5}));
  }

  function restore(){
    try{
      const s = JSON.parse(localStorage.getItem('porce_state')||'{}');
      ['F1','F5','G5','H5','I5'].forEach(k=>{ if(s[k]!==undefined) el[k].value = s[k]; });
      recalc();
    }catch(e){}
  }

  ['F1','F5','G5','H5','I5'].forEach(k=> el[k].addEventListener('input', recalc));
  document.getElementById('resetBtn').addEventListener('click', ()=>{
    ['F1','F5','G5','H5','I5'].forEach(k=> el[k].value='');
    ['F3','G3','H3','I3','SUMA'].forEach(k=> el[k].value='');
    localStorage.removeItem('porce_state');
  });

  document.getElementById('csvBtn').addEventListener('click', ()=>{
    const rows = [
      ['Osoba','Porce','Podíl (%)'],
      ['Kája', el.F3.value, el.F5.value],
      ['Máša', el.G3.value, el.G5.value],
      ['Fanda', el.H3.value, el.H5.value],
      ['Tóňa', el.I3.value, el.I5.value],
      ['Surovina (F1)', el.F1.value, ''],
      ['Suma', el.SUMA.value, '']
    ];
    const csv = rows.map(r=>r.map(v=>`"${(v??'').toString().replace('"','"')}"`).join(',')).join('
');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'porce.csv'; a.click();
    URL.revokeObjectURL(url);
  });

  if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js').catch(()=>{}); }
  restore();
})();
</script>
</body>
</html>
